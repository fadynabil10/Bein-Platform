jQuery("document").ready(function(){function e(){var e=document.getElementById("ladda"),t=Ladda.create(e);t.start(),d=sessionStorage.getItem("newAuthToken"),d?(apipath="addOptionProduct",registerData={territory:territory,custToken:d},registerData.cardBrand=jQuery("#input-card-type").val(),registerData.optionId=jQuery("#selected_package").val(),registerData.promoCode=jQuery("#input-promocode").val(),registerData.optionPrice=jQuery("#input-price").val(),registerData.languageId=beim.language_id,registerData.returnURL=beim.page_confirm_payment,console.log(registerData),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:registerData,crossDomain:!0,success:function(e){if(returnedData=JSON.parse(e),returnedData.error){switch(returnedData.error.code){case-1e3:jQuery(".register-fail").text(beim.email_exists);break;case-30:jQuery(".register-fail").text(beim.email_invalid);break;default:jQuery(".register-fail").text(returnedData.error.message)}t.stop()}else"voucher accepted"==returnedData.result.message?(t.stop(),jQuery("#confirmed-message").text(beim.confirmed_message2),setTimeout(function(){window.location.replace(beim.page_live)},1500)):returnedData.result.data&&c(returnedData.result.data,returnedData.result.action)},error:function(e){console.log(e),t.stop()}})):(console.log("No token"),t.stop())}function t(e,t){t="undefined"==typeof t||t,n(),console.log("..JJ"),console.log(e),sessionStorage.setItem("newAuthToken",e.newAuthToken),sessionStorage.setItem("smartCardId",e.smartCardId),sessionStorage.setItem("firstName",e.firstName),sessionStorage.setItem("lastName",e.lastName),sessionStorage.setItem("timestamp",Date.now()),sessionStorage.setItem("_wp_session",r("_wp_session")),jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:e,success:function(e){t&&window.location.replace(beim.page_live)},error:function(e){console.log(e)}})}function a(e,t){t="undefined"!=typeof t&&t,n(),sessionStorage.setItem("newAuthToken",e),sessionStorage.setItem("timestamp",Date.now()),t&&location.reload(!0)}function r(e){for(var t=e+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var o=a[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function o(){var e=new Date;e.setTime(e.getTime()+72e5);var t="expires="+e.toUTCString()+";",a="path=/;",r=sessionStorage.getItem("_wp_session");document.cookie="_wp_session="+r+"; "+t+a,console.log(document.cookie)}function n(){var e=new Date;e.setTime(e.getTime()+72e5);var t="expires="+e.toUTCString()+";",a="path=/;";document.cookie="miscache=1; "+t+a,console.log(document.cookie)}function s(){var e="path=/;";document.cookie="miscache=;"+e+"expires=Thu, 01 Jan 1970 00:00:01 GMT;",console.log(document.cookie)}function i(){var e="path=/;";document.cookie="_wp_session=;"+e+"expires=Thu, 01 Jan 1970 00:00:01 GMT;",console.log(document.cookie)}function u(){localStorage.removeItem("newAuthToken"),localStorage.removeItem("smartCardId"),localStorage.removeItem("firstName"),localStorage.removeItem("lastName"),localStorage.removeItem("_wp_session"),localStorage.removeItem("timestamp"),sessionStorage.removeItem("newAuthToken"),sessionStorage.removeItem("smartCardId"),sessionStorage.removeItem("firstName"),sessionStorage.removeItem("lastName"),sessionStorage.removeItem("_wp_session"),sessionStorage.removeItem("timestamp")}function l(e){apipath="getUserDetails",postData={territory:territory,custToken:e},jQuery.ajax({url:apiurl.concat(apipath),type:"post",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),m.firstName=returnedData.result.firstName,m.lastName=returnedData.result.lastName,m.newAuthToken=returnedData.result.newAuthToken,m.languageId=returnedData.result.languageId,m.smartCardId=returnedData.result.smartCardId,t(m)},error:function(e){console.log("success")}})}function c(e,t){jQuery(".btn-process-payment").length&&(jQuery(".btn-process-payment").hide(),jQuery(".process-payment").text("You will now be redirected to secure payment page...")),form='<input type="hidden" name="HPS_SessionID" value="'+e.HPS_SessionID+'">',form+='<input type="submit" name="datacash_submit" value="Submit" style="display: none;">',jQuery('<form an-attach-point="paymentForm" action="'+t+'" method="POST">'+form+"</form>").appendTo("body").submit()}if(apiurl=beim.api_url,territory="MENA",language_id=beim.language_id,dth_user=!1,"undefined"!=typeof Storage?console.log("Local storage available"):console.log("Sorry! No Web Storage support.."),null===sessionStorage.getItem("newAuthToken")||null===sessionStorage.getItem("timestamp")||sessionStorage.getItem("timestamp")<Date.now()-72e5){var d="";"/en/login/"!=window.location.pathname&&"/ar/login-ar/"!=window.location.pathname&&"/fr/se-connecter/"!=window.location.pathname&&"/en/confirm-registration/"!=window.location.pathname&&"/fr/confirm-registration/"!=window.location.pathname&&"/ar/confirm-registration/"!=window.location.pathname&&(i(),s(),u())}else{var d=sessionStorage.getItem("newAuthToken");jQuery("#subscriptions-form").attr("id","subscriptions-form_loggedin"),jQuery(".form-stage-1").addClass("stage-disabled"),jQuery(".form-stage-2").removeClass("stage-disabled"),jQuery(".form-stage-3").removeClass("stage-disabled")}var m,y=Math.floor(Date.now()/1e3);if(jQuery("#login-form, #login-form-page").submit(function(e){apipath="takeLogin",e.preventDefault(),password=jQuery("#login-form-page #input-password").val(),email=jQuery("#login-form-page #input-email").val(),postData={territory:territory,email:email,password:password},console.log(postData);var t=document.getElementById("ladda"),a=Ladda.create(t);a.start(),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),returnedData.status?(m={newAuthToken:returnedData.result.newAuthToken,action:"create_session"},l(returnedData.result.newAuthToken)):(jQuery(".alert-container").html(returnedData.error.message),jQuery(".alert-container").addClass("alert alert-danger"),a.stop())},error:function(e){jQuery(".alert-container").html(beim.incorrect_email),jQuery(".alert-container").addClass("alert alert-danger"),console.log(e),a.stop()}})}),jQuery(".navbar").length)if(null===sessionStorage.getItem("newAuthToken"))jQuery(".logged-out-menu").show(),jQuery(".logged-in-menu").hide();else{var g=sessionStorage.getItem("firstName"),D=sessionStorage.getItem("lastName");jQuery(".display_firstname").text(g),jQuery(".display_lastname").text(D),jQuery(".logged-out-menu").hide(),jQuery(".logged-in-menu").show()}if(jQuery(".page-protected").length?(console.log("protected"),null===sessionStorage.getItem("newAuthToken")?(console.log("redirecting - no session store authToken"),window.location.replace(beim.page_home)):o()):(console.log("non protected"),null!=sessionStorage.getItem("newAuthToken")&&o()),jQuery("#forgot-password-form").submit(function(e){apipath="askResetPass",e.preventDefault(),email=jQuery("#input-email").val(),postData={territory:territory,email:email},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){console.log(e),jQuery("#forgot-password-form").hide(),jQuery(".heading-underline").text(beim.check_your_email)},error:function(e){console.log(e)}})}),jQuery("#change-password-form").submit(function(e){apipath="resetPass",e.preventDefault(),email=jQuery("#field-email").val(),idHash=jQuery("#field-id-hash").val(),token=jQuery("#field-token").val(),password=jQuery("#input-new-password").val(),postData={territory:territory,email:email,emailConfirm:email,idHash:idHash,token:token,password:password,passwordConfirm:password},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),console.log(e),returnedData.status?(jQuery(".alert-container").html(beim.password_saved),jQuery(".alert-container").addClass("alert alert-success"),window.location.replace(beim.page_login)):(jQuery(".alert-container").html(beim.unable_to_reset),jQuery(".alert-container").addClass("alert alert-danger"))},error:function(e){console.log(e),jQuery(".alert-container").html(beim.token_no_longer_valid),jQuery(".alert-container").addClass("alert alert-danger")}})}),jQuery("#change-login-settings-form").submit(function(e){apipath="updatePassword",e.preventDefault(),d=sessionStorage.getItem("newAuthToken"),d?(email=jQuery("#input-email").val(),password=jQuery("#input-new-password").val(),oldpassword=jQuery("#input-old-password").val(),postData={custToken:d,territory:territory,email:email,password:password,passwordConfirm:password,oldPassword:oldpassword},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){apipath2="takeLogout",returnedData=JSON.parse(e),console.log(returnedData),returnedData.error?(jQuery(".alert-container").html(beim.enter_correct_password),jQuery(".alert-container").addClass("alert alert-danger")):(postData={territory:territory,custToken:returnedData.result.newAuthToken},jQuery.ajax({url:apiurl.concat(apipath2),type:"POST",data:postData,crossDomain:!0,success:function(e){s(),u(),returnedData=JSON.parse(e),senddata={action:"kill_session"},jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:senddata,success:function(e){window.location.replace(beim.page_home)},error:function(e){console.log(e)}})},error:function(e){console.log(e)}}))},error:function(e){console.log(e)}})):console.log("No token")}),jQuery("#change-login-settings-form").length&&(apipath="getUserDetails",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){retData=JSON.parse(e),jQuery("#input-email").val(retData.result.email),a(retData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery("#access-connect-form").submit(function(e){apipath="smartcardAuthenticate",e.preventDefault(),mobile=jQuery("#access-connect-form #input-mobile").val(),mobile=mobile.replace(/ /g,""),smartcardserial=jQuery("#access-connect-form #input-smartcardserial").val(),postData={territory:territory,smartcardserial:smartcardserial,mobile:mobile},console.log(postData);var t=document.getElementById("ladda"),a=Ladda.create(t);a.start(),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){if(returnedData=JSON.parse(e),console.log(returnedData),returnedData.status){var t="";jQuery.each(returnedData.result,function(e,a){t+='<input type="hidden" name="'+e+'" value="'+a+'">'}),jQuery('<form  action="'+beim.page_dth_activation+'" method="POST">'+t+"</form>").appendTo("body").submit()}else jQuery(".alert-container").html(returnedData.error.message),jQuery(".alert-container").addClass("alert alert-danger")},error:function(e){console.log(returnedData),jQuery(".alert-container").html("error"),jQuery(".alert-container").addClass("alert alert-danger"),console.log(e),a.stop()}})}),jQuery("#myaccount-form").submit(function(e){e.preventDefault(),apipath="changeUserDetails";var t=document.getElementById("ladda"),r=Ladda.create(t);r.start(),d=sessionStorage.getItem("newAuthToken"),d?(registerData={territory:territory,custToken:d},inputmobile=jQuery("#input-phone").val(),"0"==inputmobile.charAt(0)&&(inputmobile=parseInt(inputmobile),inputmobile="+"+inputmobile.toString()),registerData.email=jQuery("#input-email").val(),registerData.emailConfirm=jQuery("#input-email").val(),registerData.firstName=jQuery("#input-firstname").val(),registerData.lastName=jQuery("#input-lastname").val(),registerData.mobile=inputmobile,registerData.dateofbirth=jQuery("#input-dob").val(),registerData.languageId=jQuery("#input-language").val(),jQuery("input#input-allownews").is(":checked")?registerData.allowNews=1:registerData.allowNews=0,jQuery("input#input-allownews-third").is(":checked")?registerData.partner=1:registerData.partner=0,jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:registerData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),apipath="changeAddress",addressData={territory:territory,custToken:returnedData.result.newAuthToken},addressData.name="address",addressData.addressFirstName=jQuery("#input-firstname").val(),addressData.addressLastName=jQuery("#input-lastname").val(),addressData.addressStreet=jQuery("#input-street").val(),addressData.addressSecondStreet=jQuery("#input-propertyname").val(),addressData.addressNumber="0",addressData.addressZip="000000",addressData.addressCity=jQuery("#input-city").val(),addressData.addressCountry=jQuery("#input-country").val(),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:addressData,crossDomain:!0,success:function(e){jQuery(".alert-container").append('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+beim.profile_updated+".</div>"),returnedData=JSON.parse(e),console.log(returnedData),a(returnedData.result.newAuthToken,!0)},error:function(e){console.log(e),jQuery(".alert-container").append('<div class="alert alert-error alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+beim.something_went_wrong+".</div>"),r.stop()}})},error:function(e){console.log(e),jQuery(".alert-container").append('<div class="alert alert-error alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Something went wrong, please try again.</div>'),r.stop()}})):(console.log("No token"),r.stop())}),jQuery("#contact-form").submit(function(e){e.preventDefault();var t=document.getElementById("ladda"),a=Ladda.create(t);a.start();var r={territory:territory};jQuery.ajax({url:"/",type:"POST",data:r,crossDomain:!0,success:function(e){jQuery(".alert-container").append('<div class="alert alert-success alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Profile updated.</div>')},error:function(e){console.log(e),jQuery(".alert-container").append('<div class="alert alert-error alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>Something went wrong, please try again.</div>')}}).always(function(){a.stop()})}),jQuery("#subscriptions-form, #register-activate-form").submit(function(e){var t=document.getElementById("ladda"),a=Ladda.create(t);return a.start(),apipath="takeRegistrationMENA",registerData={territory:territory},registerData.promoCode=jQuery("#input-promocode").val(),registerData.price=parseInt(jQuery("#input-price").val()),0==registerData.price&&""==registerData.promoCode?(jQuery(".register-fail").text(beim.zero_package_error),void a.stop()):(registerData.password=jQuery("#input-password").val(),registerData.email=jQuery("#input-email").val(),registerData.passwordConfirm=jQuery("#input-confirmpassword").val(),registerData.emailConfirm=jQuery("#input-email").val(),registerData.acceptTerms=1,registerData.firstName=jQuery("#input-firstname").val(),registerData.lastName=jQuery("#input-lastname").val(),registerData.middleName=" ",""==registerData.middleName&&(registerData.middleName=" "),registerData.dateofbirth="1975-07-23",registerData.languageId=beim.language_id,registerData.addressStreet=jQuery("#input-street-address").val(),registerData.addressNumber="0",registerData.addressZip="-",registerData.addressCountry=jQuery("#input-country").val(),registerData.addressCity=jQuery("#input-address-city").val(),registerData.smartCardId=jQuery("#input-smartcard-id").val(),registerData.partner=1,registerData.allowNews=1,registerData.additionalInformation="extra",registerData.cardBrand=jQuery("#input-card-type").val(),registerData.optionId=jQuery("#selected_package").val(),registerData.promoCode=jQuery("#input-promocode").val(),registerData.title=jQuery("#input-title").val(),registerData.territory=territory,mobile=jQuery("#input-phone").val(),registerData.mobile=mobile.replace(/ /g,""),localStorage.setItem("pid",jQuery("#selected_package").val()),localStorage.setItem("cardBrand",jQuery("#input-card-type").val()),localStorage.setItem("promoCode",jQuery("#input-promocode").val()),localStorage.setItem("price",registerData.price),localStorage.setItem("subscribedAt",Date.now()),void jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:registerData,crossDomain:!0,success:function(e){if(returnedData=JSON.parse(e),returnedData.error)switch(returnedData.error.code){case-1e3:jQuery(".register-fail").text(beim.email_exists),jQuery(".register-fail").addClass("alert alert-danger");break;case-30:jQuery(".register-fail").text(beim.email_invalid),jQuery(".register-fail").addClass("alert alert-danger");break;default:jQuery(".register-fail").text(returnedData.error.message),jQuery(".register-fail").addClass("alert alert-danger")}else returnedData.result.confirmEmailSent&&(jQuery("#subscriptions-form").hide(),jQuery("#register-activate-form").hide(),jQuery(".subscription-message").show(),window.scrollTo(0,0))},error:function(e){jQuery(".register-fail").text(beim.contact_support),console.log(e)}}).always(function(){a.stop()}))}),jQuery("#subscriptions-form_loggedin").submit(function(t){t.preventDefault(),e()}),jQuery(document).on("submit","#subscriptions-form_loggedin_subscribe",function(t){t.preventDefault(),e()}),jQuery("#newsletter-form-submit").click(function(e){apipath="newsletterSignupLang",e.preventDefault(),languageId=beim.ICL_LANGUAGE_CODE.toUpperCase(),email=jQuery("#newsletter-form #subscribe-email").val(),postData={territory:territory,email:email,languageId:languageId},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),200==returnedData.code?(jQuery(".subscribe-wrapper h5").text(beim.email_added),jQuery(".subscribe-updates").hide()):"email already in db"==returnedData.description?jQuery(".subscribe-wrapper h5").text(beim.email_in_db):jQuery(".subscribe-wrapper h5").text(returnedData.description)},error:function(e){jQuery(".subscribe-wrapper h5").text(beim.email_invalid),console.log(e)}})}),jQuery(".logged-out-subscribe a").click(function(e){e.preventDefault(),"ENG"==language_id?ga("send","event","MSubBE","Sub_E_M_top","connect_conversion"):"ARA"==language_id?ga("send","event","MSubBA","Sub_A_M_top","connect_conversion"):"FRA"==language_id&&ga("send","event","MSubBF","Sub_F_M_top","connect_conversion"),null===sessionStorage.getItem("newAuthToken")?window.location.replace(beim.page_subscribe+beim.button_no_1):window.location.replace(beim.page_subscription+beim.button_no_1)}),jQuery("#confirm-registration").length&&(apipath="activateAccount",email=jQuery("#field-email").val(),idHash=jQuery("#field-id-hash").val(),token=jQuery("#field-token").val(),postData={territory:territory,email:email,idHash:idHash,token:token},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),returnedData.status?(apipath2="getUserDetails",postData={territory:territory,custToken:returnedData.result.newAuthToken},jQuery.ajax({url:apiurl.concat(apipath2),type:"post",data:postData,crossDomain:!0,success:function(e){retData=JSON.parse(e),m={newAuthToken:returnedData.result.newAuthToken,action:"create_session"},m.firstName=retData.result.firstName,m.lastName=retData.result.lastName,m.languageId=retData.result.languageId,t(m,!1),jQuery("#confirmed-message").text(beim.confirmed_message),jQuery(".confirmed-title").text(beim.confirmed),postData3={territory:territory,languageId:language_id,custToken:returnedData.result.newAuthToken},apipath3="getChannels",jQuery.ajax({url:apiurl.concat(apipath3),type:"POST",data:postData3,crossDomain:!0,success:function(e){returnedData3=JSON.parse(e),returnedData3.result?setTimeout(function(){window.location.replace(beim.page_live)},1500):(pid=localStorage.getItem("pid"),price=localStorage.getItem("price"),promoCode=localStorage.getItem("promoCode"),cardBrand=localStorage.getItem("cardBrand"),null==cardBrand&&(cardBrand=jQuery("#input-card-type option:first").val()),jQuery("#selected_package").val(pid),jQuery("#input-promocode").val(promoCode),jQuery("#input-card-type").val(cardBrand),jQuery("#input-price").val(price),pid&&(jQuery(".package").hide(),jQuery(".btn-select").hide(),selected_pid=".package.package-"+pid,jQuery(selected_pid).show(),jQuery(selected_pid).addClass("active")),jQuery("#subscriptions-form_loggedin").show())},error:function(e){console.log(e)}})},error:function(e){console.log("!")}})):(jQuery("#confirmed-message").text(returnedData.error.message),jQuery(".confirmed-title").text(beim.error))},error:function(e){console.log(e)}})),jQuery("#confirm-payment").length&&(apipath="checkPaymentStatus",dts_reference=jQuery("#field-dts_reference").val(),d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,dts_reference:dts_reference,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"post",data:postData,crossDomain:!0,success:function(e){retData=JSON.parse(e),console.log(retData),apipathx="optionsValidity",postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipathx),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),returnedData.result.options.length>0?(jQuery("#confirmed-message").text(beim.payment_confirmed_message),jQuery(".confirmed-title").text(beim.confirmed),a(returnedData.result.newAuthToken),setTimeout(function(){window.location.replace(beim.page_live)},3500)):(jQuery("#confirmed-message").text(beim.payment_failed_message),jQuery(".confirmed-title").text(beim.failed))},error:function(e){console.log(e)}})},error:function(e){console.log("success")}})):console.log("No token")),jQuery(".accept-update-card-details").length&&(apipath3="checkPaymentStatus",dts_reference=jQuery("#field-dts_reference").val(),d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,dts_reference:dts_reference,custToken:d},jQuery.ajax({url:apiurl.concat(apipath3),type:"post",data:postData,crossDomain:!0,success:function(e){retData=JSON.parse(e),console.log(retData),jQuery("#confirmed-message").text(beim.card_details_updated),jQuery("#confirmed-message").addClass("alert-success"),apipath2="getUserDetails",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath2),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),jQuery("#input-payment-type").text(returnedData.result.paymentType),jQuery("#input-payment-card-number").text(returnedData.result.paymentCardNumber),jQuery("#input-payment-holder").text(returnedData.result.paymentHolder),jQuery("#input-payment-expiration-date").text(returnedData.result.paymentExpirationDate),jQuery("#field-payment-type").val(returnedData.result.paymentType),returnedData.result.paymentCardNumber||jQuery(".payment-information").hide(),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")},error:function(e){console.log("success")}})):console.log("No token")),jQuery("#ticket-form").submit(function(e){apipath="createTicket",e.preventDefault(),d=sessionStorage.getItem("newAuthToken"),d?(categoryId=jQuery("#input-category").val(),subcategoryId=jQuery("#input-subcategory").val(),description=jQuery("#input-question").val(),postData={territory:territory,custToken:d,categoryId:categoryId,subcategoryId:subcategoryId,detailId:7,description:description},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),returnedData.status?(jQuery(".alert-container").html(beim.ticket_posted),jQuery(".alert-container").addClass("alert alert-success"),a(returnedData.result.newAuthToken),setTimeout(function(){window.location.replace(beim.page_tickets)},1500)):(jQuery(".alert-container").html(beim.ticket_error),jQuery(".alert-container").addClass("alert alert-danger"))},error:function(e){console.log(e)}})):console.log("No token")}),jQuery("#ticket-reply-form").submit(function(e){apipath="answerTicket",e.preventDefault(),d=sessionStorage.getItem("newAuthToken"),d?(ticketId=jQuery("#input-ticket-id").val(),description=jQuery("#input-question").val(),postData={territory:territory,custToken:d,ticketId:ticketId,message:description},console.log(postData),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),p="<p ><span>Just now..</span> Message: "+description+"</p>",jQuery(".list-replies").append(p)},error:function(e){console.log(e)}})):console.log("No token")}),jQuery("#ticket-reply-form").length&&(apipath="listTickets",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),ticketId=jQuery("#input-ticket-id").val(),jQuery.each(returnedData.result.tickets,function(e,t){t.ticketId==ticketId&&(jQuery("#ticket-title").text(t.title),jQuery("#ticket-description").text(t.description),jQuery.each(t.callbackAction,function(e,t){console.log(t),p="<p ><span>"+t.date+"</span> Message: "+t.message+"</p>",jQuery(".list-replies").append(p)}))}),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery("#tickets-api").length&&(apipath="listOptions",postData={territory:territory,custToken:"72d566067df0e18348010cc28ffa7160b4b89a158ab3f271582e1fe9b973c24acbf6ff47882f86c16752bab62481cf3bf4c675a2c8620f793b73746a45b21431"},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),jQuery.each(returnedData.result.options,function(e,t){console.log(e+": "+t.name),jQuery("#acf-field-api_package").append("<option value="+e+">"+t.name+"</option>")}),console.log(returnedData.result.options[3])},error:function(e){console.log(e)}})),jQuery(".beim-devices").length&&(apipath="listDevices",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),tr="",jQuery.each(returnedData.result.device,function(e,t){null===t.type&&(t.type=beim.generic_device),null===t.name&&(t.name=beim.generic_device),tr='<tr data-deviceid="'+t.uniqueDeviceId+'"><td>'+t.name+"</td><td>"+t.type+'</td><td width="130" class="no-padding"><a class="table-button device-remove">'+beim.remove+"<i>&times;</i></a></td></tr> ",jQuery(".beim-devices tbody").append(tr)}),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".beim-devices").on("click",".device-remove",function(e){$this=jQuery(this),swal({title:beim.removedevice_title,text:beim.removedevice_text,type:"warning",cancelButtonText:beim.canceldevice_buttontext,showCancelButton:!0,confirmButtonText:beim.removedevice_buttontext,closeOnConfirm:!1},function(){e.preventDefault();var t=$this.closest("tr"),r=t.data("deviceid");apipath="removeDevice",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,casDeviceId:r},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),returnedData.result?(jQuery(t).remove(),swal(beim.deleteddevice_title,beim.deleteddevice_text,"success")):swal(beim.deleteddevice_title_max,beim.deleteddevice_text_max,"error"),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")})}),jQuery(".device-actions").on("click",".remove-all-devices",function(e){swal({title:beim.removedevice_title,text:beim.removedevice_text,type:"warning",showCancelButton:!0,cancelButtonText:beim.canceldevice_buttontext,confirmButtonText:beim.removedevice_buttontext,closeOnConfirm:!1},function(){e.preventDefault(),apipath="removeDevice",d=sessionStorage.getItem("newAuthToken"),d?(jQuery(".beim-devices > tbody  > tr").each(function(e,t){device=jQuery(this),deviceid=device.data("deviceid"),postData={territory:territory,custToken:d,casDeviceId:deviceid},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),returnedData.result&&jQuery(device).remove(),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})}),setTimeout(function(){jQuery(".beim-devices > tbody  > tr").each(function(e,t){jQuery(this).remove()}),swal(beim.deleteddevice_title,beim.deleteddevice_text,"success")},3500)):console.log("No token")})}),jQuery("#input-category").length){apipath="getTicketCategories";var j;d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,languageId:beim.language_id},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),jQuery.each(returnedData.result.category,function(e,t){jQuery("#input-category").append('<option class="category-item" value='+t.categoryId+">"+t.name+"</option>")}),j=returnedData.result.subcategory,jQuery("#input-category").selectpicker("refresh"),jQuery("#input-category").on("change",function(){var e=this.value;jQuery("#input-subcategory").empty();var t=jQuery.grep(j,function(t){return t.categoryId==e});jQuery.each(t,function(e,t){jQuery("#input-subcategory").append('<option class="category-item" value='+t.subcategoryId+">"+t.name+"</option>")}),jQuery("#input-subcategory").selectpicker("refresh")})},error:function(e){console.log(e)}})):console.log("No token")}jQuery(".logout").length&&(u(),s(),apipath="takeLogout",senddata={action:"get_new_auth_token"},jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:senddata,success:function(e){returnedData=JSON.parse(e),returnedData.status?(postData={territory:territory,custToken:returnedData.newAuthToken},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),senddata={action:"kill_session"},jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:senddata,success:function(e){window.location.replace(beim.page_home)},error:function(e){console.log(e)}})},error:function(e){console.log(e),window.location.replace(beim.page_home)}})):window.location.replace(beim.page_home)},error:function(e){console.log(e),window.location.replace(beim.page_home)}})),jQuery("#input-reason").length&&(apipath="formData",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,languageId:beim.language_id},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),jQuery.each(returnedData.result.reason,function(e,t){jQuery("#input-reason").append('<option class="reason-item" value='+t.reasonId+">"+t.name+"</option>")}),subreason=returnedData.result.subreason,jQuery("#input-reason").selectpicker("refresh"),jQuery("#input-reason").on("change",function(){var e=this.value;jQuery("#input-subreason").empty();var t=jQuery.grep(subreason,function(t){return t.reasonId==e});jQuery.each(t,function(e,t){jQuery("#input-subreason").append('<option class="reason-item" value='+t.subreasonId+">"+t.name+"</option>")}),jQuery("#input-subreason").selectpicker("refresh")})},error:function(e){console.log(e)}})):console.log("No token")),jQuery("#remove-package-form").submit(function(e){$this=jQuery(this),e.preventDefault();var t=jQuery("#pid").val(),a=jQuery("#input-reason").val(),r=jQuery("#input-subreason").val();
null===r&&(r=0),apipath="removeOption",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,optionId:t,idReason:a,idSubreason:r},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),window.location.replace(beim.page_subscriptions),console.log(returnedData)},error:function(e){console.log(e)}})):console.log("No token")}),jQuery(".user-packages").on("click",".re-add-option",function(e){e.preventDefault(),$this=jQuery(this),d=sessionStorage.getItem("newAuthToken"),d?(apipath="readdOption",registerData={territory:territory,custToken:d},registerData.optionId=$this.data("optionid"),jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:registerData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),returnedData.error?(jQuery("#option-message").show(),jQuery("#option-message").addClass("alert-danger"),jQuery("#option-message").text(beim.option_readded_error)):(jQuery("#option-message").show(),jQuery("#option-message").addClass("alert-success"),jQuery("#option-message").text(beim.option_readded),setTimeout(function(){window.location.replace(beim.page_subscriptions)},2500))},error:function(e){console.log(e)}})):console.log("No token")}),jQuery(".user-packages").length&&(apipath="optionsValidity",removeButton=[],d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),localPostData={action:"get_user_options"},jQuery.each(returnedData.result.options,function(e,t){localPostData.options_id=t.optionId,jQuery.ajax({url:"/wp-admin/admin-ajax.php",type:"post",data:localPostData,success:function(a){retData=JSON.parse(a),17==t.optionId||44==t.optionId?removeButton[e]="":10==t.statusId?removeButton[e]='<a href="'+beim.page_remove_package+"?pid="+t.optionId+'" data-status="'+t.statusId+'" class="btn btn-bein-purple btn-block">'+beim.cancel_subscription+"</a>":40==t.statusId?t.validTo<y?removeButton[e]='<a href="'+beim.page_subscription+"?pid="+t.optionId+'" data-status="'+t.statusId+'" class="btn btn-bein-purple btn-block">'+beim.option_subscribe+"</a>":removeButton[e]='<a href="#" data-status="'+t.statusId+'" data-optionid="'+t.optionId+'" class="btn btn-bein-purple btn-block re-add-option">'+beim.reactivate_subscription+"</a>":(30==t.statusId,removeButton[e]='<a href="'+beim.page_subscription+"?pid="+t.optionId+'" data-status="'+t.statusId+'" class="btn btn-bein-purple btn-block">'+beim.option_subscribe+"</a>"),dth_user&&(removeButton[e]=""),30!=t.statusId&&60!=t.statusId||t.totalPrice>0&&(removeButton[e]='<form id="subscriptions-form_loggedin_subscribe"  action="#" method="POST">                                     <input type="hidden" id="input-promocode" name="input-promocode" value="" />                                     <input type="hidden" id="input-price" name="input-price" value="'+t.totalPrice+'" />                                     <input type="hidden" id="input-card-type" name="input-card-type" value="VISA" />                                     <input type="hidden" id="selected_package" name="package_id" value="'+t.optionId+'" />                                     <button class="btn btn-bein-purple btn-big btn-block ladda-button" id="ladda" data-status="'+t.statusId+'" >                                     <span class="ladda-label">  '+beim.option_subscribe+" </span>                                     </button>                                     </form>"),jQuery.each(retData,function(a,r){60!=t.statusId&&jQuery(".user-packages").append('<div class="col-md-3 col-sm-6">                                         <div class="package selected" data-packageid="'+t.optionId+'">                                         <h4>'+r.title+'</h4>                                         <span class="price">$'+r.price+"<span>"+r.frequency+'</span></span>                                         <span class="btn btn-bein-purple btn-block subscribe-btn">'+beim.option_subscribe+"</span>                                         "+removeButton[e]+"                                         </div>                                         </div>")})},error:function(e){console.log(e)}})}),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".invoices").length&&(apipath="getReceipts",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,languageId:language_id},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),tr="",jQuery.each(returnedData.result.invoices,function(e,t){jsDate=new Date(1e3*t.invoiceDate),sDate=new Date(1e3*t.startdate),eDate=new Date(1e3*t.enddate),cost=parseInt(t.amountWithVat),tr="<tr ><td>"+t.name+"</td><td>"+jsDate.toDateString()+"</td><td>"+sDate.toDateString()+"</td><td>"+eDate.toDateString()+"</td><td>"+t.currency+" "+cost.toFixed(2)+"</td><td>"+t.status+"</td></tr> ",jQuery("#invoice-list tbody").append(tr)}),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".tickets").length&&(apipath="listTickets",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),ticketurl=jQuery("table").data("ticketurl"),returnedData=JSON.parse(e),tr="",jQuery.each(returnedData.result.tickets,function(e,t){jsDate=new Date(1e3*t.createdOn),tr='<tr ><td><a href="'+ticketurl+"?tid="+t.ticketId+'">'+t.ticketId+"</a></td><td>"+jsDate.toDateString()+"</td><td>"+t.title+'</td><td><span class="status-'+t.status+'">'+t.status+"</span></td></tr> ",jQuery(".tickets tbody").append(tr)}),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".invoices").on("click",".invoice-download",function(e){if(e.preventDefault(),$this=jQuery(this),apipath="getReceiptDownload",d=sessionStorage.getItem("newAuthToken")){invoiceid=$this.data("invoiceid"),args={territory:territory,custToken:d,objectId:invoiceid},console.log(args);var t="";jQuery.each(args,function(e,a){t+='<input type="hidden" name="'+e+'" value="'+a+'">'}),jQuery('<form action="'+apiurl.concat(apipath)+'" method="POST">'+t+"</form>").appendTo("body").submit()}else console.log("No token")}),jQuery("#myaccount-form").length&&(apipath="getUserDetails",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),jQuery("#input-email").val(returnedData.result.email),jQuery("#input-firstname").val(returnedData.result.firstName),jQuery("#input-lastname").val(returnedData.result.lastName),jQuery("#input-dob").val(returnedData.result.dateofbirth),jQuery("#input-phone").val(returnedData.result.mobile),jQuery("#input-language").val(returnedData.result.languageId),jQuery("#input-language").selectpicker("refresh"),returnedData.result.allowNews&&jQuery("#input-allownews").prop("checked",!0),returnedData.result.partner&&jQuery("#input-allownews-third").prop("checked",!0),returnedData.result.smartCardId&&jQuery("#input-phone").closest("p").hide(),console.log(returnedData.result.addresses[1]),jQuery("#input-street").val(returnedData.result.addresses[1].addressStreet),jQuery("#input-city").val(returnedData.result.addresses[1].addressCity),jQuery("#input-country").val(returnedData.result.addresses[1].addressCountry),jQuery("#input-country").selectpicker("refresh"),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".beim_load_user_data").length&&(apipath="getUserDetails",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),jQuery("#input-firstname").val(returnedData.result.firstName),jQuery("#input-lastname").val(returnedData.result.lastName),jQuery("#input-email").val(returnedData.result.email),jQuery("#input-phone").val(returnedData.result.mobile),jQuery("#input-email").val(returnedData.result.email),jQuery("#input-confirmemail").val(returnedData.result.email),jQuery("#input-password").val("xxxxxxxxxxxxx"),jQuery("#input-confirmpassword").val("xxxxxxxxxxxxx"),jQuery("#input-partner").prop("checked",!0),jQuery("#input-language").val(returnedData.result.languageId),jQuery("#input-language").selectpicker("refresh"),returnedData.allowNews&&jQuery("#input-allownews").prop("checked",!0),returnedData.partner&&jQuery("#input-allow-news-third").prop("checked",!0),console.log(returnedData.result.addresses[1]),jQuery("#input-address-number").val(returnedData.result.addresses[1].addressNumber),jQuery("#input-street-address").val(returnedData.result.addresses[1].addressStreet),jQuery("#input-propertyname").val(returnedData.result.addresses[1].addressSecondStreet),jQuery("#input-address-code").val(returnedData.result.addresses[1].addressZip),jQuery("#input-address-city").val(returnedData.result.addresses[1].addressCity),jQuery("#input-country").val(returnedData.result.addresses[1].addressCountry),jQuery("#input-country").selectpicker("refresh"),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token"),apipath3="validateEuroPass",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d,optionId:49},jQuery.ajax({url:apiurl.concat(apipath3),type:"post",data:postData,crossDomain:!0,success:function(e){retData=JSON.parse(e),console.log(retData),jQuery(".package-1696").show(),jQuery(".package-1738").show()},error:function(e){console.log("success")}})):console.log("No token")),jQuery(".payment-information").length&&(apipath2="getUserDetails",d=sessionStorage.getItem("newAuthToken"),d?(postData={territory:territory,custToken:d},jQuery.ajax({url:apiurl.concat(apipath2),type:"POST",data:postData,crossDomain:!0,success:function(e){returnedData=JSON.parse(e),console.log(returnedData),jQuery("#input-payment-type").text(returnedData.result.paymentType),jQuery("#input-payment-card-number").text(returnedData.result.paymentCardNumber),jQuery("#input-payment-holder").text(returnedData.result.paymentHolder),jQuery("#input-payment-expiration-date").text(returnedData.result.paymentExpirationDate),jQuery("#field-payment-type").val(returnedData.result.paymentType),returnedData.result.paymentCardNumber||jQuery(".payment-information").hide(),returnedData.result.smartCardId&&(dth_user=!0),a(returnedData.result.newAuthToken)},error:function(e){console.log(e)}})):console.log("No token")),jQuery(".edit-card").click(function(e){e.preventDefault(),d=sessionStorage.getItem("newAuthToken"),d?(apipath="askChangeBankInformation",args={territory:territory,custToken:d},args.cardBrand=jQuery("#field-payment-type").val(),args.returnURL=beim.page_subscriptions,jQuery.ajax({url:apiurl.concat(apipath),type:"POST",data:args,crossDomain:!0,success:function(e){returnedData=JSON.parse(e);var t="";jQuery.each(returnedData.result.data,function(e,a){t+='<input type="hidden" name="'+e+'" value="'+a+'">'}),jQuery('<form action="'+returnedData.result.action+'" method="POST">'+t+"</form>").appendTo("body").submit()},error:function(e){console.log(e)}})):console.log("No token")})});